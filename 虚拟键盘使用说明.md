# 🎮 Stardew Valley 虚拟键盘版本 - 使用说明

## 📋 功能概述

这个版本为您的 Stardew Valley 多人游戏 Docker 容器添加了完整的虚拟键盘支持，让您可以在**任何设备**上畅玩游戏，特别是移动设备。

### ✨ 主要特性

- 🌐 **跨平台支持**: PC、手机、平板都能完美使用
- ⌨️ **多布局键盘**: 支持默认、Shift、数字、符号、中文等多种布局
- 🎯 **智能输入**: 自动检测输入需求，无缝切换键盘
- 🌙 **深色模式**: 优化的深色界面设计
- 📱 **移动优化**: 专为触摸设备优化的界面
- 🔤 **中文支持**: 完整的中文字体和输入支持

## 🚀 快速开始

### 第一步：准备文件

确保您有以下文件：
```
stardew-multiplayer-docker/
├── docker/
│   ├── Dockerfile.virtual-keyboard      # 虚拟键盘 Dockerfile
│   ├── virtual-keyboard.html           # 虚拟键盘界面
│   └── (其他现有文件)
├── docker-compose-virtual-keyboard.yml  # 虚拟键盘配置
├── build-virtual-keyboard.sh           # 构建脚本
└── (其他现有文件)
```

### 第二步：构建和启动

```bash
# 方式1：一键构建和启动
./build-virtual-keyboard.sh

# 方式2：分步执行
./build-virtual-keyboard.sh --build-only  # 仅构建
./build-virtual-keyboard.sh --start-only  # 仅启动
```

### 第三步：访问游戏

构建完成后，您可以通过以下方式访问：

- **Web界面（推荐）**: `http://您的IP:5801`
- **VNC客户端**: `您的IP:5902`
- **VNC密码**: `CRUD`

## 🎯 虚拟键盘使用指南

### 基本操作

1. **打开虚拟键盘**
   - 点击右下角的 ⌨️ 按钮
   - 键盘会从底部滑出

2. **关闭虚拟键盘**
   - 再次点击 ⌨️ 按钮
   - 键盘会滑回底部隐藏

3. **切换键盘布局**
   - 点击键盘上方的布局按钮
   - 可选择：默认、Shift、数字、符号、中文

### 键盘布局详解

#### 🔤 默认布局
```
q w e r t y u i o p [退格]
a s d f g h j k l   [回车]
z x c v b n m , . /
[Shift]  [空格]  [Shift]
```

#### 🔠 Shift布局
```
Q W E R T Y U I O P [退格]
A S D F G H J K L   [回车]
Z X C V B N M < > ?
[Shift]  [空格]  [Shift]
```

#### 🔢 数字布局
```
1 2 3 4 5 6 7 8 9 0 [退格]
- = [ ] \ ; '     [回车]
. /           [空格]
```

#### 🔣 符号布局
```
! @ # $ % ^ & * ( ) [退格]
_ + { } | : "     [回车]
< > ?           [空格]
```

#### 🀄 中文布局
```
你 好 世 界 游 戏 开 始 结 束 [退格]
是 的 不 是 可 以 不 行 谢 谢 [回车]
朋 友 一 起 玩 很 好    [空格]
```

### 💡 使用技巧

1. **游戏内聊天**
   - 按 `T` 键打开聊天框
   - 点击虚拟键盘输入消息
   - 按 `Enter` 发送

2. **命名物品**
   - 右键点击物品选择"重命名"
   - 使用虚拟键盘输入新名称
   - 特别适合中文命名

3. **快速输入**
   - 常用词汇使用中文布局
   - 数字输入使用数字布局
   - 符号输入使用符号布局

## 📱 移动设备优化

### 手机/平板访问

1. **浏览器推荐**
   - iOS: Safari、Chrome
   - Android: Chrome、Edge
   - 避免使用过旧的浏览器

2. **最佳分辨率**
   - 手机: 1280x720（默认）
   - 平板: 1920x1080
   - 可在 docker-compose 中调整

3. **触摸优化**
   - 支持双指缩放
   - 长按模拟右键
   - 滑动手势支持

### 性能优化设置

在 `docker-compose-virtual-keyboard.yml` 中调整：

```yaml
environment:
  # 针对移动设备优化
  - "DISPLAY_WIDTH=1280"      # 适合手机
  - "DISPLAY_HEIGHT=720"      # 适合手机
  - "DISPLAY_MODE=scale"      # 自适应缩放
  
  # 针对平板优化
  - "DISPLAY_WIDTH=1920"      # 适合平板
  - "DISPLAY_HEIGHT=1080"     # 适合平板
```

## 🔧 高级配置

### 自定义键盘布局

编辑 `docker/virtual-keyboard.html` 中的 `keyboardLayouts` 对象：

```javascript
const keyboardLayouts = {
    // 添加自定义布局
    gaming: [
        'w a s d {space} {enter}',
        'q e r t y u i o p',
        '1 2 3 4 5 6 7 8 9 0'
    ]
};
```

### 环境变量配置

| 变量 | 说明 | 默认值 |
|------|------|--------|
| `ENABLE_VIRTUAL_KEYBOARD` | 启用虚拟键盘 | `1` |
| `VIRTUAL_KEYBOARD_LAYOUT` | 默认布局 | `default` |
| `DISPLAY_WIDTH` | 显示宽度 | `1280` |
| `DISPLAY_HEIGHT` | 显示高度 | `720` |
| `ENABLE_CJK_FONT` | 中文字体支持 | `1` |
| `DARK_MODE` | 深色模式 | `1` |

### 性能调优

```yaml
# 在 docker-compose 中添加
environment:
  - "APP_NICENESS=-10"        # 提高游戏优先级
  - "KEEP_APP_RUNNING=1"      # 自动重启
  
# 资源限制
mem_limit: 2g                 # 内存限制
memswap_limit: 2g            # 交换限制
```

## 🛠️ 常见问题解决

### Q1: 虚拟键盘不显示？

**解决方案**:
1. 检查浏览器控制台是否有错误
2. 确认 JavaScript 已启用
3. 尝试刷新页面

```bash
# 检查容器状态
docker-compose -f docker-compose-virtual-keyboard.yml ps

# 查看日志
docker-compose -f docker-compose-virtual-keyboard.yml logs -f
```

### Q2: 按键不响应？

**解决方案**:
1. 确认 VNC 连接正常
2. 点击游戏区域获取焦点
3. 检查键盘布局是否正确

### Q3: 中文输入问题？

**解决方案**:
1. 确认 `ENABLE_CJK_FONT=1`
2. 检查 `LANG=zh_CN.UTF-8`
3. 重启容器后再试

```bash
# 重启容器
docker-compose -f docker-compose-virtual-keyboard.yml restart
```

### Q4: 移动设备性能问题？

**解决方案**:
1. 降低分辨率
2. 关闭不必要的模组
3. 使用性能模式

```yaml
# 低性能设备配置
environment:
  - "DISPLAY_WIDTH=1024"
  - "DISPLAY_HEIGHT=576"
  - "DISPLAY_MODE=scale"
```

## 📊 服务管理

### 常用命令

```bash
# 启动服务
./build-virtual-keyboard.sh --start-only

# 停止服务
./build-virtual-keyboard.sh --stop

# 查看日志
./build-virtual-keyboard.sh --logs

# 重启服务
docker-compose -f docker-compose-virtual-keyboard.yml restart

# 查看状态
docker-compose -f docker-compose-virtual-keyboard.yml ps
```

### 监控和维护

```bash
# 查看资源使用
docker stats stardew-virtual-keyboard

# 进入容器
docker exec -it stardew-virtual-keyboard bash

# 备份存档
cp -r valley_saves/ valley_saves_backup_$(date +%Y%m%d)
```

## 🎨 界面截图

虚拟键盘界面预览：

```
┌─────────────────────────────────────────────────┐
│                游戏画面                          │
│                                                │
│    [Stardew Valley 游戏内容]                    │
│                                                │
│                                          ⌨️     │
└─────────────────────────────────────────────────┘
│ 默认 │Shift│ 数字 │ 符号 │ 中文 │              │
├─────────────────────────────────────────────────┤
│ q w e r t y u i o p              [退格]       │
│ a s d f g h j k l                [回车]       │
│ z x c v b n m , . /                           │
│ [Shift]        [空格]        [Shift]          │
└─────────────────────────────────────────────────┘
```

## 🔄 更新和维护

### 更新虚拟键盘

```bash
# 重新构建镜像
./build-virtual-keyboard.sh --build-only

# 重启服务
./build-virtual-keyboard.sh --start-only
```

### 恢复到普通版本

```bash
# 停止虚拟键盘版本
./build-virtual-keyboard.sh --stop

# 启动普通版本
docker-compose up -d
```

## 📞 技术支持

如果您遇到问题，请：

1. 查看容器日志
2. 检查网络连接
3. 验证环境变量设置
4. 尝试重启容器

---

### 🎉 享受游戏吧！

现在您可以在任何设备上畅玩 Stardew Valley 了！虚拟键盘让多人游戏的交流变得更加便捷。

**Happy Farming! 🌾**